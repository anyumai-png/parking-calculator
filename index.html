<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>æ³Šè»Šæ”¶è²»è¨ˆç®—å™¨</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#0f172a;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --border:#1f2937;
      --blue:#3b82f6;
      --green:#22c55e;
      --yellow:#fde047;
      --red:#ef4444;
      --tabInactive:#0b1220;
      --tabActive:#0f213f;
      --input-bg:#0b1220;
      --chip:#0b1a33;
    }
    .theme-light{
      --bg:#f7fafc;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --border:#cbd5e1;
      --tabInactive:#f1f5f9;
      --tabActive:#e2e8f0;
      --input-bg:#ffffff;
      --chip:#eef2ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Noto Sans TC","Microsoft JhengHei",system-ui,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
      -webkit-text-size-adjust:100%;
    }
    .app{min-height:100%; display:flex; flex-direction:column}
    header{
      position:sticky; top:0; z-index:20;
      background:linear-gradient(180deg,rgba(12,20,38,.95),rgba(11,18,32,.95));
      border-bottom:1px solid var(--border);
      padding:12px env(safe-area-inset-right) 8px env(safe-area-inset-left);
      backdrop-filter: blur(6px);
    }
    .head-row{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .title{font-size:18px; font-weight:800; color:#93c5fd; letter-spacing:0.5px}
    .clock{font-variant-numeric:tabular-nums; font-size:22px; font-weight:900; color:#bfdbfe; background:#0b1a33; border:1px solid var(--border); border-radius:10px; padding:8px 12px; white-space:nowrap}
    .tabs{margin-top:10px; display:flex; gap:10px; overflow:auto; -webkit-overflow-scrolling:touch; padding-bottom:6px}
    .tabbtn{flex:0 0 auto; padding:12px 28px; font-size:16px; font-weight:900; color:#cbd5e1; border:1px solid var(--border); border-bottom:none; background:var(--tabInactive); border-top-left-radius:14px; border-top-right-radius:14px; user-select:none; cursor:pointer; box-shadow: inset 0 -2px 0 rgba(0,0,0,.15)}
    .tabbtn.active{background:var(--tabActive); color:#e2e8f0; border-color:#21406b; box-shadow: 0 6px 12px rgba(0,0,0,.25)}
    main{flex:1; padding:12px; max-width:900px; width:100%; margin:0 auto}
    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:14px; box-shadow:0 8px 24px rgba(0,0,0,.12)}
    .section-title{font-size:16px; color:#22c55e; margin:4px 0 10px 2px}
    label{display:block; font-size:16px; margin:8px 0 6px; color:#3b82f6}
    .row{display:flex; gap:12px; flex-wrap:wrap}
    .row .col{flex:1 1 300px; min-width:0}
    @media (max-width: 430px){ .row .col{flex:1 1 100%} }
    input[type="time"], input[type="number"], input[type="text"]{ width:100%; max-width:100%; font-size:22px; padding:12px 14px; border-radius:12px; border:2px solid var(--border); background:var(--input-bg); color:var(--text); outline:none }
    input[type="number"]::-webkit-outer-spin-button,input[type="number"]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}
    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:8px}
    .btn{flex:1 1 160px; font-size:18px; font-weight:900; padding:14px; border:none; border-radius:12px; cursor:pointer}
    .btn.blue{background:var(--blue); color:#051225; box-shadow:0 8px 18px rgba(59,130,246,.25)}
    .btn.green{background:var(--green); color:#05180f; box-shadow:0 8px 18px rgba(34,197,94,.25)}
    .btn.ghost{background:var(--input-bg); color:var(--text); border:2px solid var(--border)}
    .btn.red{background:var(--red); color:#140a0a}
    .result{margin-top:10px; background:var(--input-bg); border:2px dashed var(--border); border-radius:12px; padding:14px; font-size:18px; line-height:1.5}
    .money{font-size:36px; font-weight:900; color:var(--yellow)}
    .muted{color:var(--muted); font-size:14px}
    .chip{display:inline-block; margin-top:6px; padding:8px 10px; border-radius:10px; background:var(--chip); border:1px solid var(--border); color:#dbeafe; font-size:14px}
    table{width:100%; border-collapse:collapse}
    th,td{padding:10px; border-bottom:1px solid var(--border); font-size:14px}
    th{color:#3b82f6; text-align:left}
    td{color:var(--text)}
    .right{text-align:right}
    .warn{color:#ef4444; font-weight:800; margin-top:6px}
    .filters{display:flex; gap:10px; flex-wrap:wrap; margin:10px 0}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="head-row">
        <div class="title">ğŸš— æ³Šè»Šæ”¶è²»è¨ˆç®—å™¨</div>
        <div class="clock" id="clock">--/--/---- --:--:--</div>
      </div>
      <nav class="tabs" role="tablist" aria-label="Navigation">
        <div class="tabbtn active" data-tab="home">ä¸»é </div>
        <div class="tabbtn" data-tab="settings">è¨­å®š</div>
        <div class="tabbtn" data-tab="history">æ›†å²</div>
      </nav>
    </header>

    <main>
      <!-- Home -->
      <section id="page-home" class="page active">
        <div class="card">
          <p class="section-title">ä¸»é </p>
          <div class="chip" id="presetChip">ä½¿ç”¨é è¨­ï¼šâ€”</div>
          <div class="row">
            <div class="col">
              <label for="start">å…¥è»Šæ™‚é–“ï¼ˆå«ç§’ï¼‰</label>
              <input id="start" type="time" step="1">
            </div>
            <div class="col">
              <label for="end">å‡ºé–˜æ™‚é–“ï¼ˆå«ç§’ï¼‰</label>
              <input id="end" type="time" step="1">
            </div>
          </div>

          <label for="remark">å‚™è¨»ï¼ˆé¸å¡«ï¼Œæœƒå­˜å…¥æ›†å²ï¼‰</label>
          <input id="remark" type="text" placeholder="ä¾‹å¦‚ï¼šè»Šç‰Œã€åœè»Šå ´åç¨±â€¦">

          <div class="btns">
            <button class="btn blue" id="now">å‡ºé–˜ï¼ç¾åœ¨</button>
            <button class="btn ghost" id="swap">å…¥/å‡º å°èª¿</button>
            <button class="btn green" id="calc">è¨ˆç®—æ‡‰æ”¶ï¼ˆä½¿ç”¨é è¨­ï¼‰</button>
            <button class="btn ghost" id="clear">æ¸…é™¤</button>
          </div>

          <div class="result" aria-live="polite">
            <div>ç¸½æ™‚é•·ï¼š<span id="duration">â€”</span> <span class="muted" id="freeNote"></span></div>
            <div>å…¬å¼ï¼š<span id="formula">â€”</span></div>
            <div class="money" id="amount">$0.00</div>
            <div class="muted" id="stamp">è¨ˆç®—æ™‚é–“ï¼šâ€”</div>
            <div class="warn" id="crossday" style="display:none">âš ï¸ è·¨æ—¥ï¼ˆ+1å¤©ï¼‰</div>
          </div>
        </div>
      </section>

      <!-- Settings -->
      <section id="page-settings" class="page" style="display:none">
        <div class="card">
          <p class="section-title">è¨­å®š</p>

          <label>è¨ˆè²»å–®ä½ï¼ˆåªåœ¨é€™è£¡è¨­å®šï¼‰</label>
          <div class="row">
            <div class="col"><button class="btn ghost" id="unit-hour">æ¯å°æ™‚è¨ˆ</button></div>
            <div class="col"><button class="btn ghost" id="unit-half">æ¯åŠå°æ™‚è¨ˆ</button></div>
          </div>

          <label for="rate">é è¨­æ”¶è²»ï¼ˆ$ / å–®ä½ï¼‰</label>
          <input id="rate" type="number" min="0" step="0.5" placeholder="ä¾‹å¦‚ï¼š12">

          <div class="row">
            <div class="col">
              <label for="freeMin">å…è²»æ™‚æ®µï¼ˆåˆ†é˜ï¼Œ0 è¡¨ç¤ºæ²’æœ‰ï¼‰</label>
              <input id="freeMin" type="number" min="0" step="1" placeholder="ä¾‹å¦‚ï¼š15">
            </div>
            <div class="col">
              <label for="capFee">å°é ‚é‡‘é¡ï¼ˆ$ï¼Œ0 è¡¨ç¤ºæ²’æœ‰ï¼‰</label>
              <input id="capFee" type="number" min="0" step="0.5" placeholder="ä¾‹å¦‚ï¼š200">
            </div>
          </div>

          <label>ä¸»é¡Œ</label>
          <div class="row">
            <div class="col"><button class="btn ghost" id="theme-dark">é»‘è‰²ä¸»é¡Œ</button></div>
            <div class="col"><button class="btn ghost" id="theme-light">æ·ºè‰²ä¸»é¡Œ</button></div>
          </div>

          <div class="btns">
            <button class="btn green" id="save-def">å„²å­˜é è¨­</button>
            <button class="btn ghost" id="reset-def">æ¸…ç©ºé è¨­</button>
          </div>
          <p class="muted">é è¨­å„²å­˜åœ¨æ­¤è£ç½®ï¼ˆlocalStorageï¼‰ã€‚ä¸»é è¨ˆç®—æœƒä½¿ç”¨é€™äº›é è¨­ã€‚</p>
        </div>
      </section>

      <!-- History -->
      <section id="page-history" class="page" style="display:none">
        <div class="card">
          <p class="section-title">æ›†å²</p>

          <div class="filters">
            <input id="filterText" type="text" placeholder="ç¯©é¸ï¼ˆæœƒæœå°‹æ‰€æœ‰æ¬„ä½ï¼ŒåŒ…æ‹¬å‚™è¨»ï¼‰" style="flex:1 1 320px; font-size:18px; padding:10px 12px">
            <button class="btn ghost" id="applyFilter" style="flex:0 0 auto">å¥—ç”¨ç¯©é¸</button>
            <button class="btn ghost" id="clearFilter" style="flex:0 0 auto">æ¸…é™¤ç¯©é¸</button>
          </div>

          <div class="btns">
            <button class="btn ghost" id="export">åŒ¯å‡º CSV</button>
            <button class="btn red" id="clear-his">æ¸…é™¤æ­·å²</button>
          </div>

          <div style="overflow:auto; margin-top:10px">
            <table>
              <thead>
                <tr>
                  <th>æ™‚é–“æˆ³</th>
                  <th>å…¥</th>
                  <th>å‡º</th>
                  <th>å–®ä½</th>
                  <th class="right">å–®åƒ¹($)</th>
                  <th class="right">å…è²»(åˆ†)</th>
                  <th class="right">å°é ‚($)</th>
                  <th class="right">æ™‚é•·</th>
                  <th class="right">é‡‘é¡($)</th>
                  <th>å‚™è¨»</th>
                </tr>
              </thead>
              <tbody id="hisbody">
                <tr><td colspan="10" class="muted">æš«ç„¡ç´€éŒ„</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ===== Helpers =====
    function pad(n){return String(n).padStart(2,'0');}
    function nowParts(){
      const d=new Date();
      return {d, dd:pad(d.getDate()), mm:pad(d.getMonth()+1), yyyy:d.getFullYear(),
              hh:pad(d.getHours()), nn:pad(d.getMinutes()), ss:pad(d.getSeconds())};
    }
    function nowHMS(){const p=nowParts(); return p.hh+':'+p.nn+':'+p.ss;}
    function nowStamp(){const p=nowParts(); return p.dd+'/'+p.mm+'/'+p.yyyy+' '+p.hh+':'+p.nn+':'+p.ss;}
    function toSec(hms){const a=hms.split(':').map(Number); return (a[0]*3600)+(a[1]*60)+(a[2]||0);}
    function fromSec(sec){const h=Math.floor(sec/3600),m=Math.floor((sec%3600)/60),s=sec%60; return h+'å°æ™‚'+m+'åˆ†é˜'+s+'ç§’';}
    function money(n){return Number(n).toFixed(2);}
    function saveLS(k,v){localStorage.setItem(k,JSON.stringify(v));}
    function loadLS(k,def){try{const v=JSON.parse(localStorage.getItem(k)); return v??def}catch(_){return def}}

    // ===== Header clock =====
    const clockEl = document.getElementById('clock');
    function tickClock(){ clockEl.textContent = nowStamp(); }
    setInterval(tickClock, 1000); tickClock();

    // ===== Tabs =====
    const tabButtons = document.querySelectorAll('.tabbtn');
    const pages = {home:document.getElementById('page-home'), settings:document.getElementById('page-settings'), history:document.getElementById('page-history')};
    function showTab(name){
      tabButtons.forEach(b=> b.classList.toggle('active', b.dataset.tab===name));
      Object.entries(pages).forEach(([k,el])=> el.style.display = (k===name?'block':'none'));
      if(name==='history') renderHistory();
      if(name==='home') { syncUsingLabel(); reflectPresetChip(); }
    }
    tabButtons.forEach(b=> b.addEventListener('click', ()=> showTab(b.dataset.tab)));

    // ===== Defaults (Settings) =====
    const DEFAULTS = loadLS('parking_defaults', {unit:'hour', rate:12, freeMin:0, capFee:0, theme:'dark'});
    const unitHourBtn = document.getElementById('unit-hour');
    const unitHalfBtn = document.getElementById('unit-half');
    const rateInput = document.getElementById('rate');
    const freeMinInput = document.getElementById('freeMin');
    const capFeeInput = document.getElementById('capFee');
    const saveDefBtn = document.getElementById('save-def');
    const resetDefBtn = document.getElementById('reset-def');
    const themeDarkBtn = document.getElementById('theme-dark');
    const themeLightBtn = document.getElementById('theme-light');

    function applyTheme(){ document.body.classList.toggle('theme-light', DEFAULTS.theme==='light'); }

    function reflectDefaultsUI(){
      rateInput.value = DEFAULTS.rate ?? 12;
      freeMinInput.value = DEFAULTS.freeMin ?? 0;
      capFeeInput.value = DEFAULTS.capFee ?? 0;
      unitHourBtn.classList.toggle('ghost', DEFAULTS.unit!=='hour');
      unitHalfBtn.classList.toggle('ghost', DEFAULTS.unit!=='half');
      unitHourBtn.classList.toggle('green', DEFAULTS.unit==='hour');
      unitHalfBtn.classList.toggle('green', DEFAULTS.unit==='half');
      themeDarkBtn.classList.toggle('green', DEFAULTS.theme==='dark');
      themeLightBtn.classList.toggle('green', DEFAULTS.theme==='light');
      themeDarkBtn.classList.toggle('ghost', DEFAULTS.theme!=='dark');
      themeLightBtn.classList.toggle('ghost', DEFAULTS.theme!=='light');
      applyTheme();
      syncUsingLabel(); reflectPresetChip();
    }
    unitHourBtn.addEventListener('click', ()=>{ DEFAULTS.unit='hour'; reflectDefaultsUI(); });
    unitHalfBtn.addEventListener('click', ()=>{ DEFAULTS.unit='half'; reflectDefaultsUI(); });
    themeDarkBtn.addEventListener('click', ()=>{ DEFAULTS.theme='dark'; reflectDefaultsUI(); });
    themeLightBtn.addEventListener('click', ()=>{ DEFAULTS.theme='light'; reflectDefaultsUI(); });

    saveDefBtn.addEventListener('click', ()=>{
      const r = parseFloat(rateInput.value||'12');
      const f = parseInt(freeMinInput.value||'0',10);
      const c = parseFloat(capFeeInput.value||'0');
      DEFAULTS.rate = isNaN(r)?12:r;
      DEFAULTS.freeMin = isNaN(f)?0:f;
      DEFAULTS.capFee = isNaN(c)?0:c;
      saveLS('parking_defaults', DEFAULTS);
      alert('é è¨­å·²å„²å­˜');
      reflectDefaultsUI();
    });
    resetDefBtn.addEventListener('click', ()=>{
      localStorage.removeItem('parking_defaults');
      DEFAULTS.unit='hour'; DEFAULTS.rate=12; DEFAULTS.freeMin=0; DEFAULTS.capFee=0; DEFAULTS.theme='dark';
      alert('å·²æ¸…ç©ºé è¨­ï¼Œæ¢å¾©ã€Œæ¯å°æ™‚è¨ˆ $12ã€ç„¡å…è²»ã€ç„¡å°é ‚ã€é»‘è‰²èƒŒæ™¯ã€');
      reflectDefaultsUI();
    });

    function syncUsingLabel(){
      const unitName = DEFAULTS.unit==='hour' ? 'æ¯å°æ™‚' : 'æ¯åŠå°æ™‚';
      const price = money(DEFAULTS.rate||12);
      document.getElementById('using')?.textContent = `ä½¿ç”¨é è¨­ï¼š${unitName}ï½œ$${price} / å–®ä½`;
    }
    function reflectPresetChip(){
      const unitName = DEFAULTS.unit==='hour' ? 'æ¯å°æ™‚' : 'æ¯åŠå°æ™‚';
      const free = DEFAULTS.freeMin? `ï½œå…è²»å‰ ${DEFAULTS.freeMin} åˆ†é˜` : '';
      const cap = (DEFAULTS.capFee && DEFAULTS.capFee>0)? `ï½œå°é ‚ $${money(DEFAULTS.capFee)}` : '';
      document.getElementById('presetChip').textContent = `ä½¿ç”¨é è¨­ï¼š${unitName}ï½œ$${money(DEFAULTS.rate)} / å–®ä½${free}${cap}`;
    }

    // ===== Home =====
    const startEl = document.getElementById('start');
    const endEl = document.getElementById('end');
    const nowBtn = document.getElementById('now');
    const swapBtn = document.getElementById('swap');
    const calcBtn = document.getElementById('calc');
    const clearBtn = document.getElementById('clear');
    const durationEl = document.getElementById('duration');
    const freeNoteEl = document.getElementById('freeNote');
    const formulaEl = document.getElementById('formula');
    const amountEl = document.getElementById('amount');
    const stampEl = document.getElementById('stamp');
    const crossdayEl = document.getElementById('crossday');
    const remarkEl = document.getElementById('remark');

    function initTimes(){ startEl.value = nowHMS(); endEl.value = nowHMS(); }
    window.addEventListener('DOMContentLoaded', ()=>{ reflectDefaultsUI(); initTimes(); });

    nowBtn.addEventListener('click', ()=>{ endEl.value = nowHMS(); });
    swapBtn.addEventListener('click', ()=>{ const a=startEl.value,b=endEl.value; if(a&&b){startEl.value=b;endEl.value=a;} });
    clearBtn.addEventListener('click', ()=>{
      initTimes();
      remarkEl.value='';
      durationEl.textContent='â€”'; freeNoteEl.textContent=''; formulaEl.textContent='â€”'; amountEl.textContent='$0.00'; stampEl.textContent='è¨ˆç®—æ™‚é–“ï¼šâ€”'; crossdayEl.style.display='none';
    });

    // ===== History storage & filter =====
    function matchesFilter(text,kw){
      if(!kw) return true;
      return (text||'').toString().toLowerCase().includes(kw.toLowerCase());
    }
    function renderHistory(){
      const hisBody = document.getElementById('hisbody');
      const kw = document.getElementById('filterText').value.trim();
      const his = loadLS('parking_history', []);
      hisBody.innerHTML = '';
      const filtered = his.filter(r=> Object.values(r).some(v=> matchesFilter(v, kw)));
      if(filtered.length===0){
        hisBody.innerHTML = '<tr><td colspan="10" class="muted">æ²’æœ‰ç¬¦åˆçš„ç´€éŒ„</td></tr>';
        return;
      }
      for(const r of filtered){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${r.ts}</td>
                        <td>${r.start}</td>
                        <td>${r.end}</td>
                        <td>${r.unit}</td>
                        <td class="right">${money(r.rate)}</td>
                        <td class="right">${r.freeMin||0}</td>
                        <td class="right">${money(r.capFee||0)}</td>
                        <td class="right">${r.dur}</td>
                        <td class="right">${money(r.amt)}</td>
                        <td>${(r.remark||'')}</td>`;
        hisBody.appendChild(tr);
      }
    }
    document.getElementById('applyFilter').addEventListener('click', renderHistory);
    document.getElementById('clearFilter').addEventListener('click', ()=>{ document.getElementById('filterText').value=''; renderHistory(); });

    document.getElementById('export').addEventListener('click', ()=>{
      const his = loadLS('parking_history', []);
      if(his.length===0){ alert('æ²’æœ‰æ­·å²å¯åŒ¯å‡º'); return; }
      const header=['æ™‚é–“æˆ³','å…¥','å‡º','å–®ä½','å–®åƒ¹($)','å…è²»(åˆ†)','å°é ‚($)','æ™‚é•·','é‡‘é¡($)','å‚™è¨»'];
      const lines=[header.join(',')];
      his.forEach(r=> lines.push([r.ts,r.start,r.end,r.unit,money(r.rate),r.freeMin||0,money(r.capFee||0),r.dur,money(r.amt), (r.remark||'')].map(x=> `"${String(x).replace(/"/g,'""')}"`).join(',')));
      const blob=new Blob([lines.join('\n')],{type:'text/csv;charset=utf-8;'});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a'); a.href=url; a.download='parking_history.csv'; a.click(); URL.revokeObjectURL(url);
    });
    document.getElementById('clear-his').addEventListener('click', ()=>{
      if(confirm('ç¢ºå®šæ¸…é™¤æ‰€æœ‰æ­·å²ï¼Ÿæ­¤å‹•ä½œä¸èƒ½é‚„åŸã€‚')){
        localStorage.removeItem('parking_history'); renderHistory();
      }
    });

    // ===== Calculation (uses defaults) =====
    function calculate(){
      const s=startEl.value, e=endEl.value;
      const r=parseFloat(DEFAULTS.rate||'12');
      const freeM = parseInt(DEFAULTS.freeMin||'0',10) || 0;
      const cap = parseFloat(DEFAULTS.capFee||'0') || 0;
      if(!s||!e||isNaN(r)){ alert('è«‹è¼¸å…¥å®Œæ•´æ™‚é–“ï¼Œä¸¦å…ˆåˆ°ã€Œè¨­å®šã€å„²å­˜é è¨­ã€‚'); return; }

      let secs = toSec(e)-toSec(s);
      let crossed = false;
      if(secs<0){ crossed=true; secs += 24*3600; } // è·¨æ—¥(+1å¤©) æ­£å‘è™•ç†
      crossdayEl.style.display = crossed ? 'block' : 'none';

      const freeSecs = Math.max(0, freeM*60);
      const billSecs = Math.max(0, secs - freeSecs);

      const isHour = DEFAULTS.unit==='hour';
      const unitSecs = isHour ? 3600 : 1800;
      const unitName = isHour ? 'å°æ™‚' : 'åŠå°æ™‚';
      const units = Math.ceil(billSecs / unitSecs);
      let total = units * r;
      const hitCap = (cap>0 && total>cap);
      if(hitCap) total = cap;

      durationEl.textContent = fromSec(secs);
      freeNoteEl.textContent = freeSecs>0 ? `ï¼ˆå·²æ‰£é™¤å…è²» ${freeM} åˆ†é˜ï¼‰` : '';
      const baseFormula = `${units}${unitName} Ã— $${money(r)} = $${money(units*r)}`;
      const capNote = hitCap ? ` â†’ å¥—ç”¨å°é ‚ $${money(cap)} â†’ $${money(total)}` : '';
      formulaEl.textContent = baseFormula + capNote;
      amountEl.textContent = '$' + money(total);
      const stamp = nowStamp();
      stampEl.textContent = 'è¨ˆç®—æ™‚é–“ï¼š' + stamp;

      const row = {ts:stamp, start:s, end:e, unit:isHour?'å°æ™‚':'åŠå°æ™‚', rate:r, freeMin:freeM, capFee:cap, dur:fromSec(secs), amt:total, remark: (remarkEl.value||'')};
      const his = loadLS('parking_history', []);
      his.unshift(row); saveLS('parking_history', his);
    }
    document.getElementById('calc').addEventListener('click', calculate);

    window.addEventListener('DOMContentLoaded', reflectDefaultsUI);
  </script>
</body>
</html>
